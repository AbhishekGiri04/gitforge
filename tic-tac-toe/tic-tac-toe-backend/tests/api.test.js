const request = require('supertest');\nconst { app } = require('../src/server');\nconst { db } = require('../src/config/database');\n\ndescribe('Tic Tac Toe API', () => {\n  beforeAll(async () => {\n    // Setup test database\n    await db.migrate.latest();\n  });\n\n  beforeEach(async () => {\n    // Clean database before each test\n    await db('games').del();\n    await db('players').del();\n  });\n\n  afterAll(async () => {\n    // Close database connection\n    await db.destroy();\n  });\n\n  describe('Health Check', () => {\n    test('GET /health should return 200', async () => {\n      const response = await request(app)\n        .get('/health')\n        .expect(200);\n\n      expect(response.body.status).toBe('OK');\n      expect(response.body.message).toBe('Tic Tac Toe API is running');\n    });\n  });\n\n  describe('Game Management', () => {\n    test('POST /api/v1/games/create should create a new game', async () => {\n      const gameData = {\n        playerId: 'test-player-1',\n        playerName: 'Test Player'\n      };\n\n      const response = await request(app)\n        .post('/api/v1/games/create')\n        .send(gameData)\n        .expect(201);\n\n      expect(response.body.success).toBe(true);\n      expect(response.body.data.game.players.X.id).toBe('test-player-1');\n      expect(response.body.data.game.status).toBe('waiting');\n    });\n\n    test('POST /api/v1/games/:gameId/join should join existing game', async () => {\n      // First create a game\n      const createResponse = await request(app)\n        .post('/api/v1/games/create')\n        .send({\n          playerId: 'player1',\n          playerName: 'Player 1'\n        });\n\n      const gameId = createResponse.body.data.game.id;\n\n      // Then join the game\n      const joinResponse = await request(app)\n        .post(`/api/v1/games/${gameId}/join`)\n        .send({\n          playerId: 'player2',\n          playerName: 'Player 2'\n        })\n        .expect(200);\n\n      expect(joinResponse.body.success).toBe(true);\n      expect(joinResponse.body.data.game.players.O.id).toBe('player2');\n      expect(joinResponse.body.data.game.status).toBe('playing');\n    });\n\n    test('POST /api/v1/games/:gameId/move should make a move', async () => {\n      // Create and join a game\n      const createResponse = await request(app)\n        .post('/api/v1/games/create')\n        .send({ playerId: 'player1', playerName: 'Player 1' });\n\n      const gameId = createResponse.body.data.game.id;\n\n      await request(app)\n        .post(`/api/v1/games/${gameId}/join`)\n        .send({ playerId: 'player2', playerName: 'Player 2' });\n\n      // Make a move\n      const moveResponse = await request(app)\n        .post(`/api/v1/games/${gameId}/move`)\n        .send({\n          playerId: 'player1',\n          position: 4\n        })\n        .expect(200);\n\n      expect(moveResponse.body.success).toBe(true);\n      expect(moveResponse.body.data.game.board[4]).toBe('X');\n      expect(moveResponse.body.data.game.currentPlayer).toBe('O');\n    });\n\n    test('GET /api/v1/games/:gameId should get game by ID', async () => {\n      const createResponse = await request(app)\n        .post('/api/v1/games/create')\n        .send({ playerId: 'player1', playerName: 'Player 1' });\n\n      const gameId = createResponse.body.data.game.id;\n\n      const getResponse = await request(app)\n        .get(`/api/v1/games/${gameId}`)\n        .expect(200);\n\n      expect(getResponse.body.success).toBe(true);\n      expect(getResponse.body.data.game.id).toBe(gameId);\n    });\n  });\n\n  describe('Player Management', () => {\n    test('POST /api/v1/players should create/update player', async () => {\n      const playerData = {\n        playerId: 'test-player',\n        playerName: 'Test Player'\n      };\n\n      const response = await request(app)\n        .post('/api/v1/players')\n        .send(playerData)\n        .expect(200);\n\n      expect(response.body.success).toBe(true);\n      expect(response.body.data.player.id).toBe('test-player');\n      expect(response.body.data.player.name).toBe('Test Player');\n    });\n\n    test('GET /api/v1/players/:playerId should get player by ID', async () => {\n      // First create a player\n      await request(app)\n        .post('/api/v1/players')\n        .send({ playerId: 'test-player', playerName: 'Test Player' });\n\n      const response = await request(app)\n        .get('/api/v1/players/test-player')\n        .expect(200);\n\n      expect(response.body.success).toBe(true);\n      expect(response.body.data.player.id).toBe('test-player');\n    });\n  });\n\n  describe('Statistics', () => {\n    test('GET /api/v1/stats/overview should return overall stats', async () => {\n      const response = await request(app)\n        .get('/api/v1/stats/overview')\n        .expect(200);\n\n      expect(response.body.success).toBe(true);\n      expect(response.body.data).toHaveProperty('games');\n      expect(response.body.data).toHaveProperty('players');\n    });\n\n    test('GET /api/v1/stats/leaderboard should return leaderboard', async () => {\n      const response = await request(app)\n        .get('/api/v1/stats/leaderboard')\n        .expect(200);\n\n      expect(response.body.success).toBe(true);\n      expect(response.body.data).toHaveProperty('leaderboard');\n      expect(Array.isArray(response.body.data.leaderboard)).toBe(true);\n    });\n  });\n\n  describe('Error Handling', () => {\n    test('GET /api/v1/games/invalid-id should return 400', async () => {\n      const response = await request(app)\n        .get('/api/v1/games/invalid-id')\n        .expect(400);\n\n      expect(response.body.success).toBe(false);\n    });\n\n    test('POST /api/v1/games/create with invalid data should return 400', async () => {\n      const response = await request(app)\n        .post('/api/v1/games/create')\n        .send({})\n        .expect(400);\n\n      expect(response.body.success).toBe(false);\n    });\n  });\n});", "oldStr": "", "path": "/Users/abhishekgiri/Downloads/GITHUB_PROJECTS/gitforge/tic-tac-toe/backend/tests/api.test.js"}]